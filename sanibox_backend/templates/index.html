    {% load static %}
    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Sanibox - Home</title>
        <link rel="stylesheet" href="{% static 'css/swiper-bundle.min.css' %}">
        
        
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
        <link rel="stylesheet" href="{% static 'css/style.css' %}">
        <link rel="stylesheet" href="{% static 'css/login.css' %}">

    </head>

    <body>
        <!-- SIDEBAR MENU -->
    <div id="sidebar" class="sidebar">
    <button class="close-btn"><i class="fas fa-chevron-left"></i> Close menu</button>

    <div class="sidebar-content">
        <a href = 'http://127.0.0.1:8000/sanibox/genre/moviepage/'><button class="community-btn"><i class="fas fa-film"></i> Movies</button></a>
        <div id="loading">Loading genres...</div>
        <ul class="menu" id="genre-list"></ul>

        <!-- <h4 class="genre-title">Genre</h4>
        <div class="genres">
        <span>Action</span>
        <span>Adventure</span>
        <span>Comedy</span>
        <span>Drama</span>
        <span>Fantasy</span>
        <span>Romance</span>
        <span>Thriller</span>
        </div> -->
    </div>
    </div>
    <div class="modal-overlay" id="loginModal" style="display: None;">
        <div class="login-modal">
            <button class="close-btn-modal">&times;</button>
            <h2 class="text-center mb-4">Welcome back!</h2>

            <form>
            <label class="form-label">EMAIL ADDRESS</label>
            <input type="email" class="form-control mb-3" placeholder="name@email.com">

            <label class="form-label">PASSWORD</label>
            <input type="password" class="form-control mb-2" placeholder="Password">

            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="form-check">
                <input type="checkbox" class="form-check-input" id="rememberMe" checked>
                <label class="form-check-label" for="rememberMe">Remember me</label>
                </div>
                <a href="#" class="forgot">Forgot password?</a>
            </div>

            <!-- <div class="captcha-box mb-3">
                <div class="d-flex align-items-center justify-content-between">
                <div class="text-success fw-semibold"><i class="bi bi-check-circle-fill"></i> Success!</div>
                <img src="https://developers.cloudflare.com/images/cloudflare-logo.svg" alt="Cloudflare" width="120">
                </div>
            </div> -->

            <button type="button" class="btn-login w-100">Login</button>

            <div class="social-login mt-3">
                <p class="text-center small text-muted mb-2">Or continue with</p>
                <div class="d-flex justify-content-center gap-3">
                <button type="button" class="btn-social google"><i class="bi bi-google"></i></button>
                <button type="button" class="btn-social facebook"><i class="bi bi-facebook"></i></button>
                </div>
            </div>

            <p class="text-center mt-4 mb-0 small text">
                Donâ€™t have an account? <a href="#" class="open-register">Register</a>
            </p>
            </form>
        </div>
    </div>
    <div class="modal-overlay" id="registerModal" style="display: none;">
        <div class="login-modal">
            <button class="close-btn-modal">&times;</button>
            <h2 class="text-center mb-4">Create an Account</h2>

            <form>
            <label class="form-label">USER NAME</label>
            <input type="text" class="form-control mb-3" placeholder="Name">

            <label class="form-label">EMAIL ADDRESS</label>
            <input type="email" class="form-control mb-3" placeholder="name@email.com">

            <label class="form-label">PASSWORD</label>
            <input type="password" class="form-control mb-3" placeholder="Password">

            <label class="form-label">CONFIRM PASSWORD</label>
            <input type="password" class="form-control mb-3" placeholder="Confirm Password">

            <!-- <div class="captcha-box mb-3">
                <div class="d-flex align-items-center justify-content-between">
                <div class="text-success fw-semibold"><i class="bi bi-check-circle-fill"></i> Success!</div>
                <img src="https://developers.cloudflare.com/images/cloudflare-logo.svg" alt="Cloudflare" width="120">
                </div>
            </div> -->

            <button type="button" class="btn-login w-100">Register</button>

            <p class="text-center mt-4 mb-0 small text">
                Already have an account? <a href="#" class="open-login">Login</a>
            </p>
            </form>
        </div>
    </div>
        <!-- HEADER -->
        <header class="navbar">
        <div class="nav-left">
            <button id="menu-btn" class="menu-btn"><i class="fas fa-bars"></i></button>
            <div class="logo"><a href="{% url 'index' %}" style="text-decoration: none; color: aliceblue; font-size: 1.5rem;"><span class="highlight">Sani</span>Box</a></div>
            <div class="search-box">
                <input type="text" placeholder="Search Movies...">
                <button>Search</button>
            </div>
        </div>

        <div class = "nav-right">
            <div class="theme-toggle">
                <i id="theme-icon" class="fas fa-moon"></i>
            </div>
            <button class="login-btn">Login</button>
        </div>
        </header>
        {% block content %}
        <!-- HERO SECTION -->
        <section class="hero-slider swiper">
        <div class="swiper-wrapper" id="banner-container">
            <!-- Dynamic banners will be injected here -->
        </div>

        <!-- Optional: Swiper navigation -->
        <div class="swiper-pagination"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
        </section>

        <!-- TRENDING SECTION -->
        <section class="anime-trending">
        <div class="container">
            <div class="block_area block_area_trending">
            <div class="block_area-header">
                <div class="bah-heading">
                <h2 class="cat-heading">Trending</h2>
                </div>
            </div>
            <div class="block_area-content">
                <div class="swiper trending-swiper">
                <div class="swiper-wrapper" id="trending-wrapper"></div>
                </div>
            </div>
            </div>
        </div>
        </section>
        <section class="anime-trending">
        <div class="container">
            <div class="block_area block_area_trending">
            <div class="block_area-header">
                <div class="bah-heading">
                <h2 class="cat-heading">New</h2>
                </div>
            </div>
            <div class="block_area-content">
                <div class="swiper trending-swiper">
                <div class="swiper-wrapper" id="New-wrapper"></div>
                </div>
            </div>
            </div>
        </div>
        </section>
        {% endblock %}
        <script src="{% static 'js/swiper-bundle.min.js' %}"></script>
        
        <script>
            // === Utility Functions ===
        const getCookie = (name) => {
            const cookies = document.cookie?.split(";") || [];
            for (const cookie of cookies) {
                const [key, value] = cookie.trim().split("=");
                if (key === name) return decodeURIComponent(value);
            }
            return null;
        };

        const fetchJSON = async (url) => {
            const res = await fetch(url);
            return res.json();
        };

        // === Swiper Initialization ===
        const initSwipers = () => {
            new Swiper(".trending-swiper", {
                slidesPerView: 5,
                spaceBetween: 20,
                navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
                breakpoints: {
                    0: { slidesPerView: 2 },
                    768: { slidesPerView: 3 },
                    1024: { slidesPerView: 5 },
                },
            });

            new Swiper(".hero-slider", {
                loop: true,
                autoplay: { delay: 4000, disableOnInteraction: false },
                pagination: { el: ".hero-slider .swiper-pagination", clickable: true },
                effect: "fade",
                fadeEffect: { crossFade: true },
            });
        };

        // === Sidebar ===
        const initSidebar = () => {
            document.getElementById("menu-btn")?.addEventListener("click", () => {
                document.getElementById("sidebar")?.classList.add("active");
            });
            document.querySelector(".close-btn")?.addEventListener("click", () => {
                document.getElementById("sidebar")?.classList.remove("active");
            });
        };

        // === Theme Toggle ===
        const initThemeToggle = () => {
            const themeIcon = document.getElementById("theme-icon");
            if (!themeIcon) return;
            let isDark = true;
            themeIcon.addEventListener("click", () => {
                isDark = !isDark;
                document.body.classList.toggle("light-mode", !isDark);
                themeIcon.classList.toggle("fa-sun", !isDark);
                themeIcon.classList.toggle("fa-moon", isDark);
            });
        };

        // === Modals ===
        const initModals = () => {
            const loginModal = document.getElementById("loginModal");
            const registerModal = document.getElementById("registerModal");

            // Open login
            document.querySelector(".login-btn")?.addEventListener("click", () => {
                loginModal.style.display = "flex";
                document.body.style.overflow = "hidden";
            });

            // Close modals
            document.querySelectorAll(".close-btn-modal").forEach(btn =>
                btn.addEventListener("click", () => {
                    loginModal.style.display = registerModal.style.display = "none";
                    document.body.style.overflow = "auto";
                })
            );

            // Outside click close
            [loginModal, registerModal].forEach(modal => {
                modal?.addEventListener("click", (e) => {
                    if (e.target === modal) {
                        modal.style.display = "none";
                        document.body.style.overflow = "auto";
                    }
                });
            });

            // Switch login/register
            document.querySelector(".open-register")?.addEventListener("click", (e) => {
                e.preventDefault();
                loginModal.style.display = "none";
                registerModal.style.display = "flex";
            });

            document.querySelector(".open-login")?.addEventListener("click", (e) => {
                e.preventDefault();
                registerModal.style.display = "none";
                loginModal.style.display = "flex";
            });
        };

        // === Genre Loader ===
        const loadGenres = async () => {
            const loading = document.getElementById("loading");
            const genreList = document.getElementById("genre-list");
            if (!genreList) return;
            loading.style.display = "block";
            try {
                const { data } = await fetchJSON("http://127.0.0.1:8000/sanibox/master/genre/");
                genreList.innerHTML = Array.isArray(data)
                    ? data.map(g => `<li>${g.category_name}</li>`).join("")
                    : "<li>No genres found.</li>";
            } catch {
                genreList.innerHTML = "<li>Failed to load genres.</li>";
            } finally {
                loading.style.display = "none";
            }
        };

        // === Banners Loader ===
        const loadBanners = async () => {
            const bannerContainer = document.getElementById("banner-container");
            if (!bannerContainer) return;

            try {
                const { data: banners } = await fetchJSON("http://127.0.0.1:8000/sanibox/master/banner/");
                bannerContainer.innerHTML = banners.map((banner, i) => `
                    <div class="swiper-slide">
                        <div class="hero-banner">
                            <div class="hero-bg"><img src="${banner.image}" alt="${banner.title}"></div>
                            <div class="hero-overlay"></div>
                            <div class="hero-content">
                                <p class="spotlight">#${i + 1} Spotlight</p>
                                <h1 class="hero-title">${banner.title}</h1>
                                <div class="hero-meta">
                                    <span><i class="fas fa-tv"></i> TV</span>
                                    <span><i class="fas fa-clock"></i> ${banner.total_episodes_duration}m</span>
                                    <span><i class="fas fa-calendar"></i> ${new Date().toDateString()}</span>
                                    <span class="tag hd">${banner.maturity_rating.toUpperCase()}</span>
                                    <span class="tag sub">${banner.language.join(", ").toUpperCase()}</span>
                                </div>
                                <p class="hero-desc">${banner.movie_description}</p>
                                <div class="hero-buttons">
                                    <a href="http://127.0.0.1:8000/sanibox/moviepage/${banner.movie_code}/">
                                        <button class="btn watch"><i class="fas fa-play"></i> Watch Now</button>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join("");
                initSwipers();
            } catch (err) {
                console.error("Error fetching banners:", err);
            }
        };

        // === Movie Loader (Reusable) ===
        const loadMovies = async (url, wrapperId) => {
            const wrapper = document.getElementById(wrapperId);
            if (!wrapper) return;
            try {
                const { data } = await fetchJSON(url);
                wrapper.innerHTML = data.map(movie => `
                    <div class="card">
                        <div class="poster"><img src="${movie.thumbnail_image}" alt="${movie.title}"></div>
                        <div class="details">
                            <h1>${movie.title}</h1>
                            <h2>${movie.year} â€¢ ${movie.maturity_rating}</h2>
                            <div class="rating">${"<i class='fas fa-star'></i>".repeat(4)}<i class='far fa-star'></i>
                                <span>${(movie.trending_score / 100).toFixed(1)}/5</span>
                            </div>
                            <div class="tags">${movie.genre.map(g => `<span class="tag">${g}</span>`).join("")}</div>
                            <p class="desc">${movie.movie_description}</p>
                            <div class="cast">
                                <ul><li><img src="${movie.main_heros_image || "https://placehold.co/40x40"}" alt="Hero"></li></ul>
                            </div>
                            <a href="http://127.0.0.1:8000/sanibox/moviepage/${movie.movie_code}/" style="text-decoration:none;">
                                <div class="play-circle"><i class="fa fa-play"></i></div>
                            </a>
                        </div>
                    </div>`).join("");
            } catch (err) {
                console.error("Error fetching movies:", err);
            }
        };

        // === Google SSO Integration ===
        const initGoogleLogin = () => {
            const navRight = document.querySelector(".nav-right");
            const loginModal = document.getElementById("loginModal");
            const registerModal = document.getElementById("registerModal");

            document.querySelectorAll(".btn-social.google").forEach(btn => {
                btn.addEventListener("click", (e) => {
                    e.preventDefault();
                    [loginModal, registerModal].forEach(m => m && (m.style.display = "none"));
                    document.body.style.overflow = "";
                    localStorage.setItem("google_login_in_progress", "true");
                    window.location.href = "http://127.0.0.1:8000/accounts/google/login/";
                });
            });

            const renderUser = (data) => {
                navRight.innerHTML = `
                    <div class="theme-toggle"><i id="theme-icon" class="fas fa-moon"></i></div>
                    <div class="user-info d-flex align-items-center gap-2">
                        ${data.avatar
                            ? `<img src="${data.avatar}" class="user-avatar rounded-circle" style="width:32px;height:32px;">`
                            : `<i class="bi bi-person-circle fs-4"></i>`}
                        <span>${data.username || "User"}</span>
                    </div>
                    <button class="logout-btn btn btn-sm ms-3" style="
                        background:#ff6bcb;color:#fff;border:none;border-radius:8px;
                        padding:6px 14px;font-weight:500;transition:.3s;">Logout</button>`;
                const logoutBtn = navRight.querySelector(".logout-btn");
                logoutBtn.addEventListener("mouseover", () => logoutBtn.style.background = "#ff4fa8");
                logoutBtn.addEventListener("mouseout", () => logoutBtn.style.background = "#ff6bcb");
                logoutBtn.addEventListener("click", async () => {
                    await fetch("http://127.0.0.1:8000/accounts/logout/", {
                        method: "POST",
                        headers: { "X-CSRFToken": getCookie("csrftoken") },
                    });
                    location.reload();
                });
            };

            const checkLoginStatus = async () => {
                try {
                    const data = await fetchJSON("http://127.0.0.1:8000/sanibox/user/session/");
                    if (localStorage.getItem("google_login_in_progress")) {
                        [loginModal, registerModal].forEach(m => m && (m.style.display = "none"));
                        document.body.style.overflow = "";
                        localStorage.removeItem("google_login_in_progress");
                    }
                    if (data.is_authenticated) renderUser(data);
                } catch (err) {
                    console.error("Login check failed:", err);
                }
            };
            checkLoginStatus();
        };

        // === Initialize Everything ===
        document.addEventListener("DOMContentLoaded", () => {
            initSidebar();
            initThemeToggle();
            initModals();
            loadGenres();
            loadBanners();
            loadMovies("http://127.0.0.1:8000/sanibox/master/movie/trending/", "trending-wrapper");
            loadMovies("http://127.0.0.1:8000/sanibox/master/movie/trending/", "New-wrapper");
            initGoogleLogin();
        });
        
                
        </script>
        
    </body>

    </html>